<main>
  <div class="flex flex-col lg:flex-row md:gap-x-20">
    <dl class="flex max-w-121.25 mb-4 md:gap-x-4 md:mb-5 lg:mb-0">
      <!-- WPM -->
      <tst-metrics-data dataTitle="WPM" dataValue="{{ wpm() }}" />

      <div class="w-px bg-neutral-400 h-6" aria-hidden="true"></div>

      <!-- Accuracy -->
      <tst-metrics-data dataTitle="Accuracy" dataValue="{{ accuracy() }}%" />

      <div class="w-px bg-neutral-400 h-6" aria-hidden="true"></div>

      <!-- Time -->
      <tst-metrics-data dataTitle="Time" dataValue="{{ time() }}" />
    </dl>

    <form class="md:flex gap-x-4 mb-8" #settingsForm="ngForm">
      <fieldset>
        <div class="flex items-center gap-x-2">
          <legend class="text-neutral-400">Difficulty:</legend>

          <div class="flex gap-x-1.5">
            @for(option of difficultyOptions; track option.id) {
            <div>
              <label
                data-tstSettingsOption
                [active]="difficulty === option.value"
                [attr.for]="option.id"
                >{{ option.label }}</label
              >
              <input
                type="radio"
                name="difficulty"
                [attr.id]="option.id"
                [(ngModel)]="difficulty"
                [value]="option.value"
                class="sr-only"
              />
            </div>
            }
          </div>
        </div>
      </fieldset>

      <div class="w-px bg-neutral-400" aria-hidden="true"></div>

      <fieldset>
        <div class="flex items-center gap-x-2">
          <legend class="text-neutral-400">Mode:</legend>

          <div class="flex gap-x-1.5">
            @for(option of modeOptions; track option.id) {
            <div>
              <label
                data-tstSettingsOption
                [active]="mode === option.value"
                [attr.for]="option.id"
                >{{ option.label }}</label
              >
              <input
                type="radio"
                name="mode"
                [attr.id]="option.id"
                [(ngModel)]="mode"
                [value]="option.value"
                class="sr-only"
              />
            </div>
            }
          </div>
        </div>
      </fieldset>
    </form>
  </div>

  <div class="relative min-h-80">
    <div>
      @for(char of testText$ | async; track $index; let i = $index) {
      <span
        [class]="{
          'text-gray-800': char.state === 'PENDING',
          'text-green-500': char.state === 'CORRECT',
          'text-red-500': char.state === 'INCORRECT'
        }"
        [class.bg-red-500]="(cursorPosition$ | async) === i"
        >{{ char.value }}</span
      >
      }
    </div>

    <div
      [class.grid]="!(testStarted$ | async)"
      [class.hidden]="testStarted$ | async"
      class="absolute inset-0 w-full grid place-items-center backdrop-blur-xs bg-amber-300/30"
    >
      <div class="text-center">
        <button class="start-button cursor-pointer" (click)="onStartChallenge()">
          Start Typing Test
        </button>
        <p>Or click the text and start typing</p>
      </div>
    </div>
  </div>

  <div
    [class.block]="testStarted$ | async"
    [class.hidden]="!(testStarted$ | async)"
    class="text-center"
  >
    <button class="cursor-pointer" (click)="onRestartChallenge()">Restart Test</button>
  </div>
</main>
